<adf-curation xmlPathPrefix="omp" executionClassName="com.jnj.pangea.jde.omp.stock.OMPGdmStock_InventoryStocks" chunkSize="500" type="M2" writeTo="all" topic="PANGEA_omp_gdm_stock_inventory_stocks">

    <regions>
        <region path="/edm/material_plant_v1" mainRegion="true">
            <columns>sourceSystem,localPlant,localMaterialNumber,localBatchManagementRequirementIndicator</columns>
            <relations>
                <region path="/edm/inventory_stock" isPrimaryKey="true">
                    <columns>
                        sourceSystem,localPlant,localMaterial,localStorageLocation,localBatchId,localVendorNumber,localSpecialStockIndicator,localConsignmentSpecialStockIndicator,localUnrestrictedStock,localUnrestrictedSpecialStock,localUnrestrictedBatchStock,localUnrestrictedConsignmentStock,localQualityInspectionStock,localQualityInspectionSpecialStock,localQualityInspectionBatchStock,localQualityInspectionConsignmentStock,localRestrictedStock,localRestrictedSpecialStock,localRestrictedBatchStock,localRestrictedConsignmentStock,localBlockedStock,localBlockedBatchStock,localBlockedConsignmentStock,localReturnsStock,localReturnsBatchStock,localStockInTransitStorageLocation,localStockInTransitPlantToPlant,localStockInTransitPlant,localStockInTransitSpecial,localStockInTransitBatch,localRestrictedUseConsignment,localConsignmentStockInQualityInspection,localUnrestrictedUseConsignment,localBlkdConstStkNonBm,localTotalStockAllRestrictedBatches
                    </columns>
                    <expression>
                        sourceSystem=/edm/material_plant_v1.sourceSystem,
                        localPlant=/edm/material_plant_v1.localPlant,
                        localMaterial=/edm/material_plant_v1.localMaterialNumber
                    </expression>
                    <relations>
                        <region path="/edm/material_global_v1" isPrimaryKey="true">
                            <columns>localMaterialNumber,sourceSystem</columns>
                            <expression>
                                localMaterialNumber=/edm/inventory_stock.localMaterial,
                                sourceSystem=/edm/inventory_stock.sourceSystem
                            </expression>
                        </region>
                        <region path="/plan/cns_spl_pln_loc" isPrimaryKey="true">
                            <columns>localNumber,sourceSystem,localPlant,vendorOrCustomer</columns>
                            <expression>
                                localNumber=/edm/inventory_stock.localMaterial,
                                sourceSystem=/edm/inventory_stock.sourceSystem
                            </expression>
                        </region>
                        <region path="/plan/cns_material_plan_status" isPrimaryKey="true">
                            <columns>localMaterialNumber,localPlant,sourceSystem,spRelevant,noPlanRelevant</columns>
                            <expression>
                                localMaterialNumber=/edm/inventory_stock.localMaterial,
                                localPlant=/edm/inventory_stock.localPlant,
                                sourceSystem=/edm/inventory_stock.sourceSystem
                            </expression>
                        </region>
                        <region path="/edm/plant_v1" isPrimaryKey="true">
                            <columns>localPlant,sourceSystem,localPlanningRelevant</columns>
                            <expression>
                                localPlant=/edm/inventory_stock.localPlant
                            </expression>
                        </region>
                    </relations>
                </region>
            </relations>
        </region>
    </regions>

    <methods>
        <method name="getInventoryStock" path="/omp/inventory_stock" resultType="List" isPK="true">
            <parameters>
                <parameter name="sourceSystem" value="sourceSystem" relationship="and"></parameter>
                <parameter name="localPlant" value="localPlant" relationship="and"></parameter>
                <parameter name="localMaterial" value="localMaterialNumber"></parameter>
            </parameters>
        </method>
        <method name="getMaterialGlobalV1" path="/edm/material_global_v1" resultType="Map" isPK="true">
            <parameters>
                <parameter name="sourceSystem" value="sourceSystem" relationship="and"></parameter>
                <parameter name="localMaterial" value="localMaterial"></parameter>
            </parameters>
        </method>
        <method name="getCnsSplPlnLoc" path="/plan/cns_spl_pln_loc" resultType="Map" isPK="true">
            <parameters>
                <parameter name="sourceSystem" value="sourceSystem" relationship="and"></parameter>
                <parameter name="localNumber" value="localVendorNumber" relationship="and"></parameter>
                <parameter name="vendorOrCustomer" value="vendorOrCustomer"></parameter>
            </parameters>
        </method>
        <method name="getPlantV1" path="/edm/plant_v1" resultType="Map" isPK="true">
            <parameters>
                <parameter name="localPlant" value="localPlant"></parameter>
            </parameters>
        </method>
        <method name="getCnsSplPlnLocWithLocalPlant" path="/plan/cns_spl_pln_loc" resultType="Map" isPK="false">
            <parameters>
                <parameter name="sourceSystem" value="sourceSystem" relationship="and"></parameter>
                <parameter name="localNumber" value="localVendorNumber" relationship="and"></parameter>
                <parameter name="localPlant" value="localPlant" relationship="and"></parameter>
                <parameter name="vendorOrCustomer" value="vendorOrCustomer"></parameter>
            </parameters>
        </method>
        <method name="getCnsMaterialPlanStatus" path="/plan/cns_material_plan_status" resultType="Map" isPK="true">
            <parameters>
                <parameter name="localMaterialNumber" value="localMaterialNumber" relationship="and"></parameter>
                <parameter name="localPlant" value="localPlant" relationship="and"></parameter>
                <parameter name="sourceSystem" value="sourceSystem"></parameter>
            </parameters>
        </method>
    </methods>

    <viewRegion name="/omp/gdm_stock">
        <!-- INV4 -->
        <multis>
            <multi method="getInventoryStock" parameter="sourceSystem,localPlant,localMaterialNumber" var="inventoryStockList"
                      value="localConsignmentSpecialStockIndicator,localSpecialStockIndicator,sourceSystem,localPlant,localMaterial,localBatchId,localVendorNumber">
            </multi>
        </multis>
        <vars>
            <var name="sourceSystem" value="sourceSystem"/>
            <var name="localPlant" value="localPlant"/>
            <var name="localBatchManagementRequirementIndicator" value="localBatchManagementRequirementIndicator"/>
            <var name="localMaterialNumber" value="localMaterialNumber"/>
            <var name="productId"/>
            <var name="vendorOrCustomer" value="'V'"/>
            <var name="localNumber"/>
        </vars>
        <columns>
            <column name="stockId" isPK="true">
                <ref method="getMaterialGlobalV1" parameter="sourceSystem,localMaterial" resultType="Map" value="primaryPlanningCode,materialNumber">
                    <if test="StringInner.isStringEmpty(primaryPlanningCode)">
                        <set name="productId" value="materialNumber"></set>
                    </if>
                    <else>
                        <set name="productId" value="primaryPlanningCode"></set>
                    </else>
                </ref>
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <set name="stockId" value="StringInner.join(productId,'/',sourceSystem,'_',localPlant,'/',localBatchId)"></set>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <set name="stockId" value="StringInner.join(productId,'/',sourceSystem,'_',localPlant,'/',localBatchId,'/','K')"></set>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <if test="StringInner.isStringNotEmpty(sourceSystem)&amp;&amp;StringInner.isStringNotEmpty(localVendorNumber)&amp;&amp;StringInner.isStringNotEmpty(vendorOrCustomer)">
                                <ref method="getCnsSplPlnLoc" parameter="sourceSystem,localVendorNumber,vendorOrCustomer" resultType="Map" value="localNumber">
                                    <if test="StringInner.isStringNotEmpty(localNumber)">
                                        <set name="stockId" value="StringInner.join(productId,'/',sourceSystem,'_',localPlant,'$',localNumber,'/',localBatchId)"></set>
                                    </if>
                                </ref>
                            </if>
                        </if>
                    </else>
                </else>
            </column>
            <column name="active" hardCode="YES"/>
            <column name="activeOPRERP" hardCode="YES"/>
            <column name="activeSOPERP" hardCode="NO"/>
            <column name="batchId" value="localBatchId"/>
            <column name="blockedQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getBlockedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getBlockedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getBlockedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="consignment" isPK="true">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <set name="consignment" value="''"></set>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <set name="consignment" value="'K'"></set>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <set name="consignment" value="''"></set>
                        </if>
                    </else>
                </else>
            </column>
            <column name="certaintyID" hardCode=""/>
            <column name="eRPOrderId" hardCode=""/>
            <column name="inventoryLinkGroupId" hardCode=""/>
            <column name="lifnr">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <set name="lifnr" value="''"></set>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <set name="lifnr" value="'K'"></set>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <set name="lifnr" value="'O'"></set>
                        </if>
                    </else>
                </else>
            </column>
            <column name="locationId">
                <if test="StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref method="getPlantV1" parameter="localPlant" resultType="Map" value="localPlanningRelevant">
                        <if test="localPlanningRelevant.equals('X')">
                            <set name="locationId" value="StringInner.join(sourceSystem,'_',localPlant)"></set>
                        </if>
                    </ref>
                </if>
                <else>
                    <if test="localSpecialStockIndicator.equals('O')">
                        <ref method="getCnsSplPlnLocWithLocalPlant" parameter="sourceSystem,localNumber,localPlant,vendorOrCustomer" resultType="Map"
                             value="localNumber">
                            <if test="StringInner.isStringNotEmpty(localNumber)">
                                <set name="locationId" value="StringInner.join(sourceSystem,'_',localPlant,'$',localNumber)"></set>
                            </if>
                        </ref>
                    </if>
                </else>
            </column>
            <column name="processId" hardCode=""/>
            <column name="processTypeId" hardCode=""/>
            <column name="productId">
                <if test="StringInner.isStringNotEmpty(localMaterialNumber)&amp;&amp;StringInner.isStringNotEmpty(localPlant)&amp;&amp;StringInner.isStringNotEmpty(sourceSystem)">
                    <ref method="getCnsMaterialPlanStatus" parameter="localMaterialNumber,localPlant,sourceSystem" resultType="Map"
                         value="spRelevant,noPlanRelevant">
                        <if test="spRelevant.equals('X') || noPlanRelevant.equals('X')">
                            <ref method="getMaterialGlobalV1" parameter="localMaterialNumber,sourceSystem" resultType="Map" value="primaryPlanningCode,materialMumber">
                                <if test="StringInner.isStringNotEmpty(primaryPlanningCode)">
                                    <set name="productId" value="primaryPlanningCode"></set>
                                </if>
                                <else>
                                    <set name="productId" value="materialMumber"></set>
                                </else>
                            </ref>
                        </if>
                    </ref>
                </if>
            </column>
            <column name="qualityQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getQualityQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getQualityQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getQualityQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="quantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="receiptDate">
                <ref hook="OMPGdmStock_InventoryStocksHook.stampToDate(String.valueOf(System.currentTimeMillis()))"/>
            </column>
            <column name="restrictedQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getRestrictedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getRestrictedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getRestrictedQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="returnsQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getReturnsQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getReturnsQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getReturnsQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="startDate">
                <ref hook="OMPGdmStock_InventoryStocksHook.stampToDate(String.valueOf(System.currentTimeMillis()))"/>
            </column>
            <column name="stockType" hardCode="'level'"/>
            <column name="transferQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getTransferQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getTransferQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getTransferQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
            <column name="transitDate">
                <ref hook="OMPGdmStock_InventoryStocksHook.stampToDate(String.valueOf(System.currentTimeMillis()))"/>
            </column>
            <column name="unrestrictedQuantity">
                <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                    <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                </if>
                <else>
                    <if test="localConsignmentSpecialStockIndicator.equals('K')&amp;&amp;StringInner.isStringEmpty(localSpecialStockIndicator)">
                        <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                    </if>
                    <else>
                        <if test="StringInner.isStringEmpty(localConsignmentSpecialStockIndicator)&amp;&amp;localSpecialStockIndicator.equals('O')">
                            <ref hook="OMPGdmStock_InventoryStocksHook.getQuantity(localBatchManagementRequirementIndicator, inventoryStockList)"></ref>
                        </if>
                    </else>
                </else>
            </column>
        </columns>
    </viewRegion>

</adf-curation>