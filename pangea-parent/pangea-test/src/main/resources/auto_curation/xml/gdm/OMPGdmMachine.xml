<adf-curation executionClassName="com.jnj.pangea.omp.gdm_machine.OMPGdmMachineController"
              type="M2" writeTo="all" topic="PANGEA_V1_omp_gdm_machine">
    <regions>
        <region path="/edm/wrk_ctr" mainRegion="true" lucene="true">
            <columns>
                srcSysCd,wrkCtrTypeCd,wrkCtrNum,vldFromDt,vldToDt,wrkCtrCd,plntCd,wrkCtrCatCd,delInd,wrkCtrUsgCd,wrkCtrLocCd,respPrsnNum,wrkCtrActvCd,lockInd,schdlngInd,setupTypeCd,oprCd,setupFrmlCd,runFrmlCd,teardownFrmlCd,capyNum,locGrpCd,machTypeCd,plnrGrpCd,othFrmlCd,suplAreaCd,slocCd,mixingInd,wrkCtrDesc
            </columns>
            <filter>
                (wrkCtrUsgCd:001 OR wrkCtrUsgCd:009) AND (*:* -delInd:X)
            </filter>
            <relations>
                <region path="/edm/capy_hdr" isPrimaryKey="false">
                    <columns>
                        srcSysCd,capyNum,capyNbr,strtTm,endTm,fctryCalCd,capyCatCd,capyBaseUomCd,capyNm,capyUtlzRtPct,plnrGrpCd,poolCapyInd,plntCd,finiteSchdlngInd,mltOpsInd,ovldPct,ltpExclnInd,capyUomCd,indivCapyInd,availCapyUomCd,btneckInd,capyDesc
                    </columns>
                    <expression>
                        srcSysCd=/edm/wrk_ctr.srcSysCd,capyNum=/edm/wrk_ctr.capyNum
                    </expression>
                </region>
                <region path="/plan/cns_plan_parameter" isPrimaryKey="false">
                    <columns>
                        attribute,dataObject,parameter,parameterValue,sourceSystem
                    </columns>
                    <expression>
                        sourceSystem =/edm/wrk_ctr.srcSysCd
                    </expression>
                </region>
                <region path="/edm/wrk_ctr_hier" isPrimaryKey="false">
                    <columns>
                        srcSysCd,topWrkCtrTypeCd,topWrkCtrNum,parntWrkCtrTypeCd,parntWrkCtrNum,childWrkCtrTypeCd,childWrkCtrNum,wrkCtrTypeCd,wrkCtrNum,stopExplsInd
                    </columns>
                    <expression>
                        wrkCtrNum=/edm/wrk_ctr.wrkCtrNum,wrkCtrTypeCd=/edm/wrk_ctr.wrkCtrTypeCd,parntWrkCtrNum=/edm/wrk_ctr.wrkCtrCd
                    </expression>
                    <relations>
                        <region path="/edm/wrk_ctr" alias="/edm/wrk_ctr_clone">
                            <columns>
                                srcSysCd,wrkCtrTypeCd,wrkCtrNum,vldFromDt,vldToDt,wrkCtrCd,plntCd,wrkCtrCatCd,delInd,wrkCtrUsgCd,wrkCtrLocCd,respPrsnNum,wrkCtrActvCd,lockInd,schdlngInd,setupTypeCd,oprCd,setupFrmlCd,runFrmlCd,teardownFrmlCd,capyNum,locGrpCd,machTypeCd,plnrGrpCd,othFrmlCd,suplAreaCd,slocCd,mixingInd,wrkCtrDesc
                            </columns>
                        </region>
                    </relations>
                </region>
            </relations>
        </region>

    </regions>
    <methods>
        <method name="ruleJ1_1" path="/plan/cns_plan_parameter" resultType="Map">
            <parameters>
                <parameter name="sourceSystem" value="srcSysCd" relationship="and"></parameter>
                <parameter name="dataObject" value="'SEND_TO_OMP'"></parameter>
            </parameters>
        </method>
        <method name="ruleJ1_2" path="/edm/capy_hdr" resultType="List">
            <parameters>
                <parameter name="srcSysCd" value="srcSysCd" relationship="and"></parameter>
                <parameter name="capyNum" value="capyNum" relationship="and"></parameter>
                <parameter name="capyCatCd" value="capyCatCd"></parameter>
            </parameters>
        </method>
        <method name="ruleT6_1" path="/edm/wrk_ctr_hier" resultType="Map">
            <parameters>
                <parameter name="wrkCtrNum" value="wrkCtrNum" relationship="and"></parameter>
                <parameter name="wrkCtrTypeCd" value="wrkCtrTypeCd"></parameter>
            </parameters>
        </method>
        <method name="ruleT6_2" path="/edm/wrk_ctr_hier" resultType="Map">
            <parameters>
                <parameter name="parntWrkCtrNum" value="wrkCtrCd" relationship="and"></parameter>
                <parameter name="parntWrkCtrTypeCd" value="wrkCtrTypeCd"></parameter>
            </parameters>
        </method>
        <method name="ruleT6_3" path="/edm/wrk_ctr_clone" resultType="Map">
            <parameters>
                <parameter name="wrkCtrNum" value="parntWrkCtrNum" relationship="and"></parameter>
                <parameter name="wrkCtrTypeCd" value="parntWrkCtrTypeCd"></parameter>
            </parameters>
        </method>
    </methods>

    <viewRegion name="/omp/gdm_machine">
        <multis>
            <multi method="ruleJ1_2" parameter="srcSysCd,capyNum,capyCatCd" var="capyHdrList"
                   value="srcSysCd,finiteSchdlngInd"/>
        </multis>
        <filters>
            <filter hook="OMPGdmMachineHook.check(e.getValue())"/>
        </filters>
        <vars>
            <var name="srcSysCd" value="srcSysCd"></var>
            <var name="plntCd" value="plntCd"></var>
            <var name="wrkCtrCd" value="wrkCtrCd"></var>
            <var name="wrkCtrDesc" value="wrkCtrDesc"></var>
            <var name="capyCatCd" value="'001'"></var>
            <var name="capyNum" value="capyNum"></var>
            <var name="finiteSchdlngInd" value="finiteSchdlngInd"></var>
            <var name="wrkCtrNum" value="wrkCtrNum"></var>
            <var name="wrkCtrTypeCd" value="wrkCtrTypeCd"></var>
            <var name="srcSysCd_ctr"></var>
            <var name="plntCd_ctr"></var>
            <var name="parntWrkCtrNum"></var>
            <var name="parntWrkCtrTypeCd"></var>
            <var name="finiteSchdlngInd"></var>
        </vars>
        <sets>
            <set name="srcSysCd_ctr" value="srcSysCd"/>
            <set name="plntCd_ctr" value="plntCd"/>
        </sets>
        <columns>
            <column name="machineId" isPK="true">
                <if test="StringInner.isStringNotEmpty(srcSysCd_ctr)&amp;&amp;StringInner.isStringNotEmpty(plntCd_ctr)
                    &amp;&amp;StringInner.isStringNotEmpty(wrkCtrCd)">
                    <set name="machineId" value="StringInner.join(srcSysCd_ctr,'/',plntCd_ctr,'/',wrkCtrCd)"></set>
                </if>
            </column>
            <column name="active" hardCode="'YES'"></column>
            <column name="activeOPRERP" hardCode="'YES'"></column>
            <column name="activeSOPERP" hardCode="'NO'"></column>
            <column name="building" value="wrkCtrLocCd"></column>
            <column name="description">
                <if test="StringInner.isStringNotEmpty(wrkCtrDesc)">
                    <ref hook="OMPGdmMachineHook.getDescription(wrkCtrDesc)"></ref>
                </if>
            </column>
            <column name="locationId">
                <if test="StringInner.isStringNotEmpty(srcSysCd_ctr)&amp;&amp;StringInner.isStringNotEmpty(plntCd_ctr)">
                    <set name="locationId" value="StringInner.join(srcSysCd_ctr,'_',plntCd_ctr)"></set>
                </if>
            </column>
            <column name="machineCapacity">
                <if test="finiteSchdlngInd.equals('X')">
                    <set name="machineCapacity" value="'finite'"></set>
                </if>
                <else>
                    <set name="machineCapacity" value="'infinite'"></set>
                </else>
            </column>
            <column name="machineTypeId" hardCode="'Production'"></column>
            <column name="parentMachineId">
                <ref method="ruleT6_1" parameter="wrkCtrNum,wrkCtrTypeCd"
                     value="parntWrkCtrNum,parntWrkCtrTypeCd,srcSysCd" resultType="Map">
                    <if test="StringInner.isStringNotEmpty(parntWrkCtrNum)&amp;&amp;StringInner.isStringNotEmpty(parntWrkCtrTypeCd)">
                        <ref method="ruleT6_3" parameter="parntWrkCtrNum,parntWrkCtrTypeCd" value="wrkCtrCd"
                             resultType="Map">
                            <if test="StringInner.isStringNotEmpty(wrkCtrCd)">
                                <set name="parentMachineId"
                                     value="StringInner.join(srcSysCd,'/',plntCd_ctr,'/',wrkCtrCd)"></set>
                            </if>
                            <else>
                                <set name="parentMachineId" value="''"></set>
                            </else>
                        </ref>
                    </if>
                    <else>
                        <set name="parentMachineId" value="''"></set>
                    </else>
                </ref>
            </column>
        </columns>
    </viewRegion>
</adf-curation>
