@pangea_test @AEAZ-3678
Feature: EDMInventoryStock AEAZ-3678

  Scenario: Full Load curation

    Given I import "/project_one/mard" by keyFields "lgort,mandt,matnr,werks"
      | mandt | matnr              | werks | lgort | labst    | insme    | speme | retme | umlmc | umlme | keinm | kinsm | klabs | kspem | einme |
      | 120   | 000000000000132264 | CO01  | CO01  | 280.00   | 160.00   | 1.972 | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 0.00  | 0.0   | 0.0   |
      | 120   | 000000000000132264 | CO01  | CO02  | 280.00   | 160.00   | 1     | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 0.00  | 0.0   | 0.0   |
      | 120   | 000000000000132264 | CO01  | CO06  | 1785.00  | 175.00   | 0.986 | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 0.00  | 0.0   | 0.0   |
      | 120   | 000000000000132264 | CO01  | CO07  | 1788.00  | 175.00   | 1     | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 0.00  | 0.0   | 0.0   |
      | 120   | 000000000000132264 | CO01  | CO08  | 279.00   | 0.00     | 3     | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 32.00 | 0.0   | 0.0   |
      | 120   | 000000000000132265 | CO01  | CO08  | 0.00     | 0.00     | 0     | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 0.00  | 0.0   | 0.0   |
      | 120   | 000000000000132266 | CO01  | CO08  | 10000.00 | 10000.00 | 1     | 0.0   | 0.0   | 0.0   | 0.0   | 0.0   | 1.00  | 0.0   | 0.0   |


    And I wait "/project_one/mard" Async Queue complete

    Given I import "/edm/source_system_v1" by keyFields "localSourceSystem"
      | localSourceSystem | sourceSystem |
      | Project_One       | CONS_LATAM   |
      | [Consumer LATAM]  | CONS_LATAM   |
    And I wait "/edm/source_system_v1" Async Queue complete

    Given I import "/project_one/mchb" by keyFields "charg,lgort,matnr,werks,mandt"
      | charg           | lgort | matnr              | werks | clabs    | cinsm | ceinm | cspem    | cretm   | cumlm   | mandt |
      | 0027LKE30       | CO01  | 000000000000132264 | CO01  | 1000.00  | 1     | 0     | 650.00   | 2.00    | 2.00    | 120   |
      | 0027LKH24       | CO01  | 000000000000132264 | CO01  | 458.00   | 1     | 0     | 416.00   | 0.00    | 0.00    | 120   |
      | 0027LKH27       | CO01  | 000000000000132264 | CO01  | 300.00   | 1     | 0     | 108.00   | 0.00    | 0.00    | 120   |
      | 0027LKH28       | CO01  | 000000000000132264 | CO01  | 6.00     | 1     | 0     | 0.00     | 0.00    | 0.00    | 120   |
      | 0027LKH29       | CO01  | 000000000000132264 | CO01  | 6.00     | 1     | 0     | 0.00     | 0.00    | 0.00    | 120   |
      | 0027LKH31       | CO01  | 000000000000132265 | CO01  | 0.00     | 1     | 0     | 0.00     | 0.00    | 0.00    | 120   |
      | SAME-BATCH-TEST | CO01  | 000000000000132266 | CO01  | 10000.00 | 1     | 0     | 11000.00 | 1000.00 | 1000.00 | 120   |
    And I wait "/project_one/mchb" Async Queue complete

    Given I import "/project_one/mkol" by keyFields "charg,lifnr,lgort,mandt,matnr,sobkz,werks"
      | mandt | matnr              | werks | lgort | charg           | sobkz | lifnr | slabs    | sinsm    | seinm    | sspem    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000290992      | K     | 16137 | 200.000  | 2.000    | 2.000    | 2.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000297736      | K     | 16137 | 10.000   | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000307039      | K     | 16137 | 25.000   | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000311362      | K     | 16137 | 3.000    | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000314532      | K     | 16137 | 1.000    | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000326688      | K     | 16137 | 89.000   | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | CO02  | 4000339593      | K     | 16137 | 0.000    | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132266 | CO01  | CO02  | SAME-BATCH-TEST | K     | 16137 | 1000.000 | 1000.000 | 1000.000 | 1000.000 |

    And I wait "/project_one/mkol" Async Queue complete

    Given I import "/project_one/mslb" by keyFields "charg,lifnr,mandt,matnr,sobkz,werks"
      | mandt | matnr              | werks | charg           | sobkz | lifnr | lblab    | lbins    | lbein    | lbuml    |
      | 120   | 000000000000132264 | CO01  | 4000263377      | O     | 15574 | 108.000  | 2.000    | 2.000    | 2.000    |
      | 120   | 000000000000132264 | CO01  | 4000279495      | O     | 15574 | 103.000  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000290992      | O     | 15574 | 103.000  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000297736      | O     | 15574 | 104.900  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000307039      | O     | 15574 | 107.000  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000311362      | O     | 15574 | 6960.000 | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000314532      | O     | 15574 | 108.000  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000326688      | O     | 15574 | 103.000  | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132264 | CO01  | 4000339593      | O     | 15574 | 0.000    | 0.000    | 0.000    | 0.000    |
      | 120   | 000000000000132266 | CO01  | SAME-BATCH-TEST | O     | 15574 | 1000.000 | 1000.000 | 1000.000 | 1000.000 |

    And I wait "/project_one/mslb" Async Queue complete

    Given I import "/project_one/marc" by keyFields "mandt,matnr,werks"
      | mandt | matnr              | werks | trame |
      | 120   | 000000000000132264 | CO01  | 0.000 |
#      | 120   | 000000000000132288 | CO01  | 0     |
#      | 120   | 000000000000132294 | CO01  | 0     |
    And I wait "/project_one/marc" Async Queue complete

    When I submit task with xml file "xml/edm/EDMInventoryStock.xml" and execute file "jar/pangea-view.jar"

    Then I check region data "/edm/inventory_stock_v1" by keyFields "localBatchId,localConsignmentSpecialStockIndicator,localPlant,localSpecialStockIndicator,sourceSystem,localStorageLocation,localMaterial,localVendorNumber"
      | sourceSystem | localPlant | localMaterial      | localStorageLocation | localBatchId    | localVendorNumber | localSpecialStockIndicator | localConsignmentSpecialStockIndicator | localUnrestrictedStock | localUnrestrictedSpecialStock | localUnrestrictedBatchStock | localUnrestrictedConsignmentStock | localQualityInspectionStock | localQualityInspectionSpecialStock | localQualityInspectionBatchStock | localQualityInspectionConsignmentStock | localRestrictedStock | localRestrictedSpecialStock | localRestrictedBatchStock | localRestrictedConsignmentStock | localBlockedStock | localBlockedBatchStock | localBlockedConsignmentStock | localReturnsStock | localReturnsBatchStock | localStockInTransitStorageLocation | localStockInTransitPlantToPlant | localStockInTransitPlant | localStockInTransitSpecial | localStockInTransitBatch | localRestrictedUseConsignment | localConsignmentStockInQualityInspection | localUnrestrictedUseConsignment | localBlkdConstStkNonBm | localTotalStockAllRestrictedBatches |
      #       MARD(6)
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 |              |                   |                            |                                       | 280.00                 | 0.0                           | 0.0                         | 0.0                               | 160.00                      | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 1.972             | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.00                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 |              |                   |                            |                                       | 280.00                 | 0.0                           | 0.0                         | 0.0                               | 160.00                      | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 1                 | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.00                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO06                 |              |                   |                            |                                       | 1785.00                | 0.0                           | 0.0                         | 0.0                               | 175.00                      | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 0.986             | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.00                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO07                 |              |                   |                            |                                       | 1788.00                | 0.0                           | 0.0                         | 0.0                               | 175.00                      | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 1                 | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.00                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO08                 |              |                   |                            |                                       | 279.00                 | 0.0                           | 0.0                         | 0.0                               | 0.00                        | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 3                 | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 32.00                           | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132266 | CO08                 |              |                   |                            |                                       | 10000.00               | 0.0                           | 0.0                         | 0.0                               | 10000.00                    | 0.0                                | 0.0                              | 0.0                                    | 0.0                  | 0.0                         | 0.0                       | 0.0                             | 1                 | 0.0                    | 0.0                          | 0.0               | 0.0                    |            0.0                     | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 1.00                            | 0.0                    | 0.0                                 |
#     MCHB(5)
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 | 0027LKE30    |                   |                            |                                       | 0.0                 | 0.0                           | 1000.00                     | 0.0                               | 0.0                      | 0.0                                | 1                                | 0.0                                    | 0.0                  | 0.0                         | 0                         | 0.0                             | 0.0             | 650.00                 | 0.0                          | 0.0               | 2.00                   | 0.0                                | 0.0                             | 0.0                      | 0.0                        | 2.00                     | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 | 0027LKH24    |                   |                            |                                       | 0.0                 | 0.0                           | 458.00                      | 0.0                               | 0.0                      | 0.0                                | 1                                | 0.0                                    | 0.0                  | 0.0                         | 0                         | 0.0                             | 0.0             | 416.00                 | 0.0                          | 0.0               | 0.00                   | 0.0                                | 0.0                             | 0.0                      | 0.0                        | 0.00                     | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 | 0027LKH27    |                   |                            |                                       | 0.0                 | 0.0                           | 300.00                      | 0.0                               | 0.0                      | 0.0                                | 1                                | 0.0                                    | 0.0                  | 0.0                         | 0                         | 0.0                             | 0.0             | 108.00                 | 0.0                          | 0.0               | 0.00                   | 0.0                                | 0.0                             | 0.0                      | 0.0                        | 0.00                     | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 | 0027LKH28    |                   |                            |                                       | 0.0                 | 0.0                           | 6.00                        | 0.0                               | 0.0                      | 0.0                                | 1                                | 0.0                                    | 0.0                  | 0.0                         | 0                         | 0.0                             | 0.0             | 0.00                   | 0.0                          | 0.0               | 0.00                   | 0.0                                | 0.0                             | 0.0                      | 0.0                        | 0.00                     | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO01                 | 0027LKH29    |                   |                            |                                       | 0.0                 | 0.0                           | 6.00                        | 0.0                               | 0.0                      | 0.0                                | 1                                | 0.0                                    | 0.0                  | 0.0                         | 0                         | 0.0                             | 0.0             | 0.00                   | 0.0                          | 0.0               | 0.00                   | 0.0                                | 0.0                             | 0.0                      | 0.0                        | 0.00                     | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
#      mslb(9)
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000263377      | 15574              | O                             |                                           | 0.0                      | 108.000		                          | 0.0                           | 0.0                                   | 0.0                           | 2.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 2.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 2.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000279495      | 15574              | O                             |                                           | 0.0                      | 103.000		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000290992      | 15574              | O                             |                                           | 0.0                      | 103.000		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000297736      | 15574              | O                             |                                           | 0.0                      | 104.900		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000307039      | 15574              | O                             |                                           | 0.0                      | 107.000		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                               | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000311362      | 15574              | O                             |                                           | 0.0                      | 6960.000                        | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000314532      | 15574              | O                             |                                           | 0.0                      | 108.000		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 |                         | 4000326688      | 15574              | O                             |                                           | 0.0                      | 103.000		                          | 0.0                           | 0.0                                   | 0.0                           | 0.000	                                   | 0.0                                  | 0.0                                       | 0.0                    | 0.000	                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        | 0.000	                          | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132266 |                         | SAME-BATCH-TEST | 15574              | O                             |                                           | 0.0                      | 1000.000                        | 0.0                           | 0.0                                   | 0.0                           | 1000.000                                   | 0.0                                  | 0.0                                       | 0.0                    | 1000.000                      | 0.0                          | 0.0                                | 0.0                 | 0.0                      | 0.0                             | 0.0                 | 0.0                     | 0.0                                   | 0.0                                 | 0.0                        |1000.000                           | 0.0                        | 0.0                              | 0.0                                          | 0.0                                | 0.0                      | 0.0                                 |
  #       mkol(6)
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000290992   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 200.000                           | 0.0                      | 0.0                                | 0.0                              | 2.000                                  | 0.0                  | 0.0                         | 0.0                       | 2.000                           | 0.0                 | 0.0                    | 2.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000297736   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 10.000                            | 0.0                      | 0.0                                | 0.0                              | 0.000                                  | 0.0                  | 0.0                         | 0.0                       | 0.000                           | 0.0                 | 0.0                    | 0.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000307039   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 25.000                            | 0.0                      | 0.0                                | 0.0                              | 0.000                                  | 0.0                  | 0.0                         | 0.0                       | 0.000                           | 0.0                 | 0.0                    | 0.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000311362   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 3.000                             | 0.0                      | 0.0                                | 0.0                              | 0.000                                  | 0.0                  | 0.0                         | 0.0                       | 0.000                           | 0.0                 | 0.0                    | 0.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000314532   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 1.000                             | 0.0                      | 0.0                                | 0.0                              | 0.000                                  | 0.0                  | 0.0                         | 0.0                       | 0.000                           | 0.0                 | 0.0                    | 0.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |
      | CONS_LATAM   | CO01       | 000000000000132264 | CO02                 | 4000326688   | 16137             |                            | K                                     | 0.0                 | 0.0                           | 0.0                         | 89.000                            | 0.0                      | 0.0                                | 0.0                              | 0.000                                  | 0.0                  | 0.0                         | 0.0                       | 0.000                           | 0.0                 | 0.0                    | 0.000                        | 0.0               | 0.0                    |     0.0                            | 0.0                             | 0.0                      | 0.0                        | 0.0                      | 0.0                           | 0.0                                      | 0.0                            | 0.0                    | 0.0                                 |

    Then I check region data "/plan/edm_failed_data" by keyFields "functionalArea,interfaceID,errorCode,sourceSystem,key1,key2,key3,key4,key5"
      | functionalArea | interfaceID | errorCode | sourceSystem | businessArea | key1 | key2 | key3 | key4 | key5 | errorValue |

#    And I compare the number of records between "/project_one/mard" and "/edm/inventory_stock_v1,/plan/edm_failed_data"

  #  And I delete the test data

    #And I will remove all data with region "/edm/inventory_stock_v1"

   # And I will remove all data with region "/plan/edm_failed_data"

