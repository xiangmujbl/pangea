@pangea_test @AEAZ-8801
Feature: OMPGdmPLOFromERPV1 AEAZ-8801

  @Scenario1
  Scenario: OMPGdmPLOFromERPV1

    When I import "/edm/planned_order_v1" by keyFields "srcSysCd,mfgPlanOrdrDocId"
      | srcSysCd   | plntCd | firmingInd | fxScrapQty | grDaysLeadQty | matlNum | mfgPlanOrdrDocId | mrpCtlId | planOrdrEndDt | planOrdrEndTm | planOrdrQty | planOrdrStrtDt | planOrdrTypeCd | planPlntCd | plngScnroCd | prcmtTypeCd | prdtnFnshdDt | prdtnStrtDt | prdtnStrtTm | prdtnVers | prdtnVersNum | reqQty | sLocCd | splPrcmtTypeCd | uomCd | internalTimeStamp |
      | CONS_LATAM | BR02   | X          | 0          | 10            | 8553    | 3367468          | 501      | 20180611      | 0             | 840         | 20180610       | LA             | BR02       | 000         | E           | 20180617     | 20180609    | 0           | V001      | 0            | 0      | BR02   | E              | BAG   | 1530646050        |
      | CONS_LATAM | BR02   | X          | 0          | 1             | 3486    | 3367499          | 501      | 20180611      | 0             | 84          | 20180610       | LA             | BR02       | 001         | E           | 20180621     | 20180610    | 0           | V002      | 0            | 0      | BR02   | E              | BOT   | 1530646127        |
      | CONS_LATAM | BR02   | X          | 0          | 1             | 3483    | 3797853          | 606      | 20180602      | 0             | 50          | 20180601       | LA             | BR02       | 000         | E           | 20180602     | 20180601    | 0           | V002      | 0            | 0      | BR01   | E              | CCM   | 1530646204        |
      | CONS_LATAM | BR02   | X          | 0          | 2             | 968     | 4022312          | 501      | 20180614      | 0             | 386         | 20180613       | LA             | BR02       | 000         | E           |              |             | 0           | V001      | 0            | 0      | BR02   | E              | CD    | 1530646281        |
      | CONS_LATAM | BR02   | X          | 0          | 0             | 3293    | 4022330          | 501      | 20180607      | 0             | 900         | 20180606       | LA             | BR02       | 000         | E           | 20180617     | 20180606    | 0           | V003      | 0            | 0      | BR02   | E              | CM    | 1530646358        |
      | CONS_LATAM | BR02   | X          | 0          | 3             | 72345   | 4022331          | 501      | 20180611      | 0             | 900         | 20180610       | LA             | BR02       | 000         | E           |              |             | 0           | V001      | 0            | 0      | BR02   | E              | CS    | 1530646435        |
      | CONS_LATAM | BR02   | X          | 0          | 1             | 23845   | 4022332          | 501      | 20180613      | 0             | 900         | 20180612       | LA             | BR02       | 000         | E           |              |             | 0           | V001      | 0            | 0      | BR02   | E              | D46   | 1530646512        |
      | CONS_LATAM | BR04   | X          | 0          | 3             | 9837    | 4022337          | 501      | 20180701      | 0             | 900         | 20180630       | LA             | BR04       | 000         | E           | 20180721     | 20180628    | 0           | V006      | 0            | 0      | BR04   | E              | DR    | 1530646589        |
      | CONS_LATAM | BR02   | X          | 0          | 2             | 2435    | 4022338          | 501      | 20180701      | 0             | 900         | 20180630       | LA             | BR02       | 000         | E           | 20180701     | 20180630    | 0           | V001      | 0            | 0      | BR02   | E              | BAG   | 1530646666        |
      | CONS_LATAM | BR02   | X          | 0          | 0             | 900875  | 4022339          | 501      | 20180701      | 0             | 900         | 20180630       | LA             | BR02       | 000         | E           | 20180711     | 20180629    | 0           | V001      | 0            | 0      | BR02   | E              | BOT   | 1530646743        |
      | CONS_LATAM | BR02   | X          | 0          | 3             | 2314    | 4022340          | 501      | 20180701      | 0             | 1522        | 20180630       | LA             | BR02       | 000         | E           | 20180707     | 20180630    | 0           | V001      | 0            | 0      | BR02   | E              | CCM   | 1530646820        |
      | CONS_LATAM | BR02   | X          | 0          | 1             | 87400   | 4022341          | 501      | 20180701      | 0             | 1522        | 20180630       | LA             | BR02       | 000         | E           | 20180712     | 20180629    | 0           | V001      | 0            | 0      | BR02   | E              | CD    | 1530646897        |
      | CONS_LATAM | BR02   | X          | 0          | 0             | 2309    | 4022342          | 501      | 20180701      | 0             | 1522        | 20180630       | LA             | BR02       | 000         | E           | 20180713     | 20180630    | 0           | V007      | 0            | 0      | BR02   | E              | CS    | 1530646974        |
    And I wait "/edm/planned_order_v1" Async Queue complete

    When I import "/plan/cns_plant_attr" by keyFields "UUID"
      | UUID                                 | sourceSystem | localPlanningRelevant | localPlant | localPlantName                 | localPlantType | locationAttribute1Desc | locationAttribute1Value | locationAttribute2Desc | locationAttribute2Value | locationAttribute3Desc | locationAttribute3Value | locationAttribute4Desc | locationAttribute4Value | planLocTypeDesc              | planLocTypeId | plant | plantType               |
      | 077199f9-a48a-492e-941c-8980c373b604 | CONS_LATAM   | X                     | BR02       | J&J Costa Rica - Bond Fiscal   | DC             | Country                | Costa Rica              | Volume                 | Medium                  |                        |                         |                        |                         | Virtual/Logical Plant        | VP            | CR02  | DC, Distribution Center |
      | 07ce39ec-a079-4076-91e5-89e35141f64d | CONS_LATAM   |                       | BR04       | J&J DO-S.Domingos 1-R.Dominica | DC             | Country                | S.Domingos              | Volume                 | Medium                  |                        |                         |                        |                         | Distribution Center          | DC            | DO02  | DC, Distribution Center |
      | 132e8cde-5fc9-4f99-a773-452493bc3214 | CONS_LATAM   | X                     | BR25       | J&J BR-Goi�nia - Com&Distrib   | DC             | Country                | Brazil                  | Volume                 | Medium                  |                        |                         |                        |                         | Distribution Center          | DC            | BR63  | DC, Distribution Center |
      | 20145e0c-7958-42e3-a939-4d3c2ca3b0c5 | CONS_LATAM   | X                     | MX02       | Sales & Marketing              | DC             | Country                | Mexico                  | Volume                 | Low                     |                        |                         |                        |                         | Distribution Center          | DC            | MX32  | DC, Distribution Center |
      | 369e9ea3-c18d-45a3-be55-78e366f3997c | CONS_LATAM   | X                     | GT02       | J&J Guatemala - Bond Fiscal    | DC             | Country                | Guatemala               | Volume                 | Low                     |                        |                         |                        |                         | Virtual/Logical Plant        | VP            | GT02  | DC, Distribution Center |
      | 4dac30cf-794b-4009-9dfc-5daa16baba1a | CONS_LATAM   | X                     | CO02       | J&J Colombia - S&M (CO02)      | DC             | Country                | Colombia                | Volume                 | Low                     |                        |                         |                        |                         | Distribution Center          | DC            | CO08  | DC, Distribution Center |
      | 56d6b2f9-fc60-4eb6-947e-6b6b64e5dce7 | CONS_LATAM   | X                     | VE01       | J&J VE-Valencia-Planta         |                | Country                | Valencia                | Volume                 | High                    |                        |                         |                        |                         | Internal Manufacturing Plant | IM            | VE06  | MP,�Manufacturing�Plant |
      | 60c32f3f-8d26-4737-a8f8-79ebf1e32f2b | CONS_LATAM   | X                     | BR16       | J&J BR-Extrema - Com&Distrib   | DC             | Country                | Brazil                  | Volume                 | Medium                  |                        |                         |                        |                         | Distribution Center          | DC            | BR61  | DC, Distribution Center |
      | 614d5eed-cfd3-4de9-9740-6055c8432361 | CONS_LATAM   | X                     | BR19       | J&J BR-Nova Odessa - Com&Distr | DC             | Country                | Brazil                  | Volume                 | Medium                  |                        |                         |                        |                         | Distribution Center          | DC            | BR69  | DC, Distribution Center |
      | 618812c3-2347-49f9-9ee4-0e51b9168361 | CONS_LATAM   | X                     | PE01       | J&J PE-Lima-S&M                | DC             | Country                | Peru                    | Volume                 | Medium                  |                        |                         |                        |                         | Distribution Center          | DC            | PE03  | DC, Distribution Center |
    And I wait "/plan/cns_plant_attr" Async Queue complete

    When I import "/plan/cns_material_plan_status" by keyFields "sourceSystem,localPlant,localMaterialNumber"
      | sourceSystem | localPlant | active | dpRelevant | localMaterialNumber | localParentCode | materialNumber | noPlanRelevant | parentActive | ppc    | spRelevant |
      | CONS_LATAM   | BR02       | X      | X          | 8553                |                 | 8553           |                | X            | 8553   | X          |
      | CONS_LATAM   | BR02       | X      | X          | 3486                |                 | 3486           |                | X            | 3486   | X          |
      | CONS_LATAM   | BR02       | X      | X          | 3483                |                 | 3483           |                | X            | 3483   | X          |
      | CONS_LATAM   | BR02       | X      | X          | 968                 |                 | 968            |                | X            | 968    | X          |
      | CONS_LATAM   | BR02       | X      | X          | 3293                |                 | 3293           |                | X            | 3293   | X          |
      | CONS_LATAM   | BR02       | X      |            | 72345               |                 | 72345          |                | X            | 72345  | X          |
      | CONS_LATAM   | BR02       | X      | X          | 23845               |                 | 23845          |                | X            | 23845  | X          |
      | CONS_LATAM   | BR04       | X      | X          | 9837                |                 | 9837           |                | X            | 9837   | X          |
      | CONS_LATAM   | BR02       | X      | X          | 2435                |                 | 2435           |                | X            | 2435   | X          |
      | CONS_LATAM   | BR02       | X      | X          | 900875              |                 | 900875         |                | X            | 900875 | X          |
      | CONS_LATAM   | BR02       | X      | X          | 2314                |                 | 2314           |                | X            | 2314   |            |
      | CONS_LATAM   | BR02       | X      | X          | 87400               |                 | 87400          |                | X            | 87400  | X          |
      | CONS_LATAM   | BR02       | X      | X          | 2309                |                 | 2309           |                | X            | 2309   | X          |
    And I wait "/plan/cns_material_plan_status" Async Queue complete

    When I import "/edm/material_global_v1" by keyFields "sourceSystem,localMaterialNumber"
      | sourceSystem | localMaterialNumber | materialNumber | baseUom | batchManageIndicator | brand | category | division | flagForDeletion | form | franchise | globalBusinessUnit | globalDpParentCode | localBaseUom | localDpParentCode | localManufacturingTechnology | localMaterialGroup | localMaterialType | localRefDescription                 | manufacturingTechnology | materialGroup | materialStatus | materialType | minRemShelfLife | parentCode | primaryPlanningCode | productFamily | refDescription | subBrand | totalShelfLife |
      | CONS_LATAM   | 8553                | 8553           | BAG     | X                    |       |          | 10       |                 |      |           |                    |                    | BAG          |                   |                              | 1                  | FERT              | JS COTTON BALLS 50 GRX20 T50P35     |                         |               | 8              |              | 180             |            | 34                  |               |                |          | 1825           |
      | CONS_LATAM   | 3486                | 3486           | BOT     | X                    |       |          | 10       |                 |      |           |                    |                    | BOT          |                   |                              | 1                  | FERT              | REACH TOOTHBRUSH COMPACT SOFT T2P1  |                         |               | 7              |              | 180             |            | 35                  |               |                |          | 730            |
      | CONS_LATAM   | 3483                | 3483           | CCM     | X                    |       |          | 10       |                 |      |           |                    |                    | CCM          |                   |                              | 1                  | FERT              | PR ESC REACH CP MC L2P1             |                         |               | 7              |              | 180             |            | 36                  |               |                |          | 730            |
      | CONS_LATAM   | 968                 | 968            | CD      | X                    |       |          | 10       |                 |      |           |                    |                    | CD           |                   |                              | 1                  | FERT              | PR BOLAS ALG J  10X100  B AID TATOO |                         |               | 7              |              | 180             |            | 37                  |               |                |          | 730            |
      | CONS_LATAM   | 3293                | 3293           | CM      | X                    |       |          | 10       |                 |      |           |                    |                    | CM           |                   |                              | 1                  | FERT              | REACH TB PLUS SOFT LONG 200UN       |                         |               | 7              |              | 180             |            | 38                  |               |                |          | 9999           |
      | CONS_LATAM   | 72345               | 72345          | CS      | X                    |       |          | 10       |                 |      |           |                    |                    | CS           |                   |                              | 1                  | FERT              | PR BOLAS ALG J 20X50 +B AID TATOO   |                         |               | 7              |              | 180             |            | 39                  |               |                |          | 730            |
      | CONS_LATAM   | 23845               | 23845          | D46     | X                    |       |          | 10       |                 |      |           |                    |                    | D46          |                   |                              | 1                  | FERT              | REACH TB CONTROL SOFT COMPACT       |                         |               | 7              |              | 180             |            | 40                  |               |                |          | 9999           |
      | CONS_LATAM   | 9837                | 9837           | DR      | X                    |       |          | 10       |                 |      |           |                    |                    | DR           |                   |                              | 1                  | FERT              | REACH TB CONTROL MEDI COMPACT       |                         |               | 7              |              | 180             |            | 41                  |               |                |          | 9999           |
      | CONS_LATAM   | 2435                | 2435           | BAG     | X                    |       |          | 10       |                 |      |           |                    |                    | BAG          |                   |                              | 1                  | FERT              | REACH TB CONTROL SOFT LONG          |                         |               | 7              |              | 180             |            | 42                  |               |                |          | 9999           |
      | CONS_LATAM   | 900875              | 900875         | BOT     | X                    |       |          | 10       |                 |      |           |                    |                    | BOT          |                   |                              | 1                  | FERT              | PRES JONTEX SENSITIVE 48X3UN        |                         |               | 8              |              | 180             |            | 43                  |               |                |          | 1095           |
      | CONS_LATAM   | 2314                | 2314           | CCM     | X                    |       |          | 10       |                 |      |           |                    |                    | CCM          |                   |                              | 1                  | FERT              | FC PRES JONTEX SENSITIVE 48X3UN     |                         |               | 8              |              | 180             |            | 44                  |               |                |          | 9999           |
      | CONS_LATAM   | 87400               | 87400          | CD      | X                    |       |          | 10       |                 |      |           |                    |                    | CD           |                   |                              | 1                  | FERT              | TF PRES JONTEX SENSITIVE 48X3UN     |                         |               | 8              |              | 180             |            | 45                  |               |                |          | 9999           |
      | CONS_LATAM   | 2309                | 2309           | CS      | X                    |       |          | 10       |                 |      |           |                    |                    | CS           |                   |                              | 1                  | FERT              | CT PRES JONTEX SENSITIVE 48X3UN     |                         |               | 8              |              | 180             |            | 46                  |               |                |          | 1095           |
    And I wait "/edm/material_global_v1" Async Queue complete

    When I import "/plan/cns_plan_unit" by keyFields "sourceSystem,localUom,localUomName,planFlag,unit"
      | sourceSystem | factor | localUom | localUomName     | planFlag | roundingDecimal | unit |
      | CONS_LATAM   | 1      | BAG      | Bag              | SP       | 0               | BAG  |
      | CONS_LATAM   | 1      | BOT      | Bottle           | SP       | 0               | BO   |
      | CONS_LATAM   | 1      | CCM      | Cubic centimeter | SP       | 3               | CCM  |
      | CONS_LATAM   | 1      | CD       | Candela          | SP       | 0               | CD   |
      | CONS_LATAM   | 1      | CM       | Centimeter       | SP       | 3               | CM   |
      | CONS_LATAM   | 1      | CS       | Case             | DPSP     | 0               | CA   |
      | CONS_LATAM   | 1      | D46      | Voltampere       | SP       | 0               | VAM  |
      | CONS_LATAM   | 1      | DR       | Drum             | SP       | 0               | DR   |
    And I wait "/plan/cns_plan_unit" Async Queue complete

    When I submit task with xml file "xml/omp/OMPGdmPLOFromERPV1.xml" and execute file "jar/pangea-view.jar"

    Then A file is found on sink application with name "GDMPLOFromERP.tsv"

    Then I check file data for filename "GDMPLOFromERP.tsv" by keyFields "PLOFromERPId"
#    Then I check region data "/omp/gdm_plo_from_erp" by keyFields "PLOFromERPId"
      | PLOFromERPId       | deleted | endDate             | ERPId              | internalTimeStamp | kdauf | kdpos | locationId      | manualOffset | PLOType | productId | startDate           | totalQuantity | unitId | verid |
      | CONS_LATAM/3367468 | NO      | 2018/06/29 00:00:00 | CONS_LATAM/3367468 | 1530646050        |       |       | CONS_LATAM_BR02 | 0            | LA      | 34        | 2018/06/09 00:00:00 | 840           | BAG    | V001  |
      | CONS_LATAM/3797853 | NO      | 2018/06/04 00:00:00 | CONS_LATAM/3797853 | 1530646204        |       |       | CONS_LATAM_BR02 | 0            | LA      | 36        | 2018/06/01 00:00:00 | 50            | CCM    | V002  |
      | CONS_LATAM/4022312 | NO      | 2018/06/18 00:00:00 | CONS_LATAM/4022312 | 1530646281        |       |       | CONS_LATAM_BR02 | 0            | LA      | 37        | 2018/06/13 00:00:00 | 386           | CD     | V001  |
      | CONS_LATAM/4022330 | NO      | 2018/06/17 00:00:00 | CONS_LATAM/4022330 | 1530646358        |       |       | CONS_LATAM_BR02 | 0            | LA      | 38        | 2018/06/06 00:00:00 | 900           | CM     | V003  |
      | CONS_LATAM/4022331 | NO      | 2018/06/14 00:00:00 | CONS_LATAM/4022331 | 1530646435        |       |       | CONS_LATAM_BR02 | 0            | LA      | 39        | 2018/06/10 00:00:00 | 900           | CA     | V001  |
      | CONS_LATAM/4022332 | NO      | 2018/06/14 00:00:00 | CONS_LATAM/4022332 | 1530646512        |       |       | CONS_LATAM_BR02 | 0            | LA      | 40        | 2018/06/12 00:00:00 | 900           | VAM    | V001  |
      | CONS_LATAM/4022337 | NO      | 2018/07/25 00:00:00 | CONS_LATAM/4022337 | 1530646589        |       |       |                 | 0            | LA      |           | 2018/06/28 00:00:00 | 900           | DR     | V006  |
      | CONS_LATAM/4022338 | NO      | 2018/07/03 00:00:00 | CONS_LATAM/4022338 | 1530646666        |       |       | CONS_LATAM_BR02 | 0            | LA      | 42        | 2018/06/30 00:00:00 | 900           | BAG    | V001  |
      | CONS_LATAM/4022339 | NO      | 2018/07/11 00:00:00 | CONS_LATAM/4022339 | 1530646743        |       |       | CONS_LATAM_BR02 | 0            | LA      | 43        | 2018/06/29 00:00:00 | 900           | BO     | V001  |
      | CONS_LATAM/4022340 | NO      | 2018/07/11 00:00:00 | CONS_LATAM/4022340 | 1530646820        |       |       |                 | 0            | LA      |           | 2018/06/30 00:00:00 | 1522          | CCM    | V001  |
      | CONS_LATAM/4022341 | NO      | 2018/07/13 00:00:00 | CONS_LATAM/4022341 | 1530646897        |       |       | CONS_LATAM_BR02 | 0            | LA      | 45        | 2018/06/29 00:00:00 | 1522          | CD     | V001  |
      | CONS_LATAM/4022342 | NO      | 2018/07/13 00:00:00 | CONS_LATAM/4022342 | 1530646974        |       |       | CONS_LATAM_BR02 | 0            | LA      | 46        | 2018/06/30 00:00:00 | 1522          | CA     | V007  |


#    And I will remove the test file on sink application "GDMPLOFromERP.tsv"
    And I delete the test data

    And I will remove all data with region "/omp/gdm_plo_from_erp"

        